<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Solo Leveling System V3 üéÆ</title>
    <style>
        :root {
            --bg-color: #1a1b26;
            --primary-text: #c0caf5;
            /* Sky blue */
            --secondary-text: #7aa2f7;
            --accent-color: #bb9af7;
            --toggle-active: #5fb3ff;
            --border-color: #414868;
            --bg-color2: #24283b;
            --secondary-accent: #565f89;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-text);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            color: var(--secondary-text);
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .overall-level {
            background-color: var(--bg-color2);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            margin-bottom: 20px;
        }

        .overall-level h2 {
            color: var(--accent-color);
            font-size: 1.5rem;
            text-align: center;
        }

        .tabs {
            display: flex;
            background-color: var(--bg-color2);
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            margin-bottom: 0;
        }

        .tab-button {
            flex: 1;
            padding: 15px;
            background-color: var(--border-color);
            color: var(--primary-text);
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .tab-button:hover {
            background-color: var(--secondary-accent);
        }

        .tab-button.active {
            background-color: var(--secondary-text);
            color: var(--bg-color);
        }

        .tab-content {
            background-color: var(--bg-color2);
            border-radius: 0 0 10px 10px;
            padding: 20px;
            min-height: 500px;
            border: 2px solid var(--border-color);
            border-top: none;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .attribute-section {
            background-color: var(--border-color);
            margin-bottom: 20px;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid var(--secondary-accent);
        }

        .attribute-header {
            color: var(--accent-color);
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
        }

        .skill-item {
            background-color: var(--bg-color2);
            padding: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .skill-name {
            flex: 1;
        }

        .skill-level {
            color: var(--secondary-text);
            font-weight: bold;
        }

        .update-form {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .update-attribute {
            margin-bottom: 20px;
        }

        .update-skill {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 5px;
            background-color: var(--border-color);
            border-radius: 5px;
        }

        .update-skill label {
            flex: 1;
            margin-right: 10px;
        }

        .current-level {
            color: var(--secondary-text);
            font-weight: bold;
            margin: 0 10px;
            min-width: 40px;
        }

        .update-skill input {
            width: 60px;
            padding: 5px;
            background-color: var(--bg-color);
            border: 1px solid var(--secondary-accent);
            border-radius: 3px;
            color: var(--primary-text);
            text-align: center;
        }

        .button {
            background-color: var(--border-color);
            color: var(--primary-text);
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
            transition: background-color 0.3s;
        }

        .button:hover {
            background-color: var(--secondary-accent);
        }

        .button.primary {
            background-color: var(--secondary-text);
            color: var(--bg-color);
        }

        .button.primary:hover {
            background-color: #9ec5ff;
        }

        .button.success {
            background-color: #9ece6a;
            color: var(--bg-color);
        }

        .button.danger {
            background-color: #f7768e;
            color: var(--bg-color);
        }

        .button.crystal {
            background-color: var(--accent-color);
            color: var(--bg-color);
        }

        .chart-container {
            margin-top: 20px;
        }

        .chart-buttons {
            margin-bottom: 20px;
            text-align: center;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
        }

        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--secondary-accent);
        }

        .history-table th {
            background-color: var(--secondary-text);
            color: var(--bg-color);
            font-weight: bold;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            background-color: var(--bg-color2);
            margin: 5% auto;
            padding: 30px;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80%;
            overflow-y: auto;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--accent-color);
            font-size: 1.8rem;
        }

        .close {
            color: #f7768e;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #ff9aa2;
        }

        .date-input {
            margin-bottom: 20px;
            text-align: center;
        }

        .date-input input {
            background-color: var(--bg-color);
            border: 1px solid var(--secondary-accent);
            border-radius: 5px;
            padding: 8px;
            color: var(--primary-text);
            margin-left: 10px;
        }

        .progress-bar {
            background-color: var(--bg-color);
            border-radius: 10px;
            overflow: hidden;
            margin: 5px 0;
        }

        .progress-fill {
            height: 20px;
            background-color: var(--secondary-text);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bg-color);
            font-weight: bold;
            font-size: 0.8rem;
        }

        .crystal-instructions {
            background-color: var(--border-color);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent-color);
        }

        .crystal-rating {
            display: grid;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }

        .crystal-skill {
            display: flex;
            align-items: center;
            background-color: var(--border-color);
            padding: 10px;
            border-radius: 5px;
        }

        .crystal-skill label {
            flex: 1;
            margin-right: 15px;
        }

        .crystal-skill input {
            width: 80px;
            padding: 8px;
            background-color: var(--bg-color);
            border: 1px solid var(--secondary-accent);
            border-radius: 3px;
            color: var(--primary-text);
            text-align: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .tabs {
                flex-direction: column;
            }

            .skills-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ SOLO LEVELING SYSTEM üéÆ</h1>
            <div class="overall-level">
                <h2 id="overall-level">üèÜ OVERALL LEVEL: 5/500</h2>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('stats')">üìä Current Stats</button>
            <button class="tab-button" onclick="showTab('update')">üìà Update Skills</button>
            <button class="tab-button" onclick="showTab('progress')">üìà Progress Charts</button>
            <button class="tab-button" onclick="showTab('history')">üìö Session History</button>
        </div>

        <div class="tab-content">
            <!-- Stats Tab -->
            <div id="stats-tab" class="tab-panel active">
                <div id="stats-container"></div>
            </div>

            <!-- Update Tab -->
            <div id="update-tab" class="tab-panel">
                <div class="date-input">
                    <label for="custom-date">Custom Date (YYYY-MM-DD):</label>
                    <input type="date" id="custom-date">
                </div>
                <div id="update-container"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="button primary" onclick="processSkillUpdates()">üíæ Save Updates</button>
                </div>
            </div>

            <!-- Progress Tab -->
            <div id="progress-tab" class="tab-panel">
                <div class="chart-buttons">
                    <button class="button primary" onclick="showAttributeChart()">üìä Attribute Levels</button>
                    <button class="button success" onclick="showProgressChart()">üìà Progress Over Time</button>
                    <button class="button danger" onclick="showSkillHeatmap()">üéØ Skill Overview</button>
                </div>
                <div class="chart-container">
                    <canvas id="progress-chart" width="800" height="400"></canvas>
                </div>
            </div>

            <!-- History Tab -->
            <div id="history-tab" class="tab-panel">
                <table class="history-table" id="history-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Total Gains</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody id="history-tbody">
                    </tbody>
                </table>
            </div>
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <button class="button crystal" onclick="showCrystalBallDialog()">üîÆ Crystal Ball Assessment</button>
            <button class="button success" onclick="refreshAllData()">üîÑ Refresh All</button>
        </div>
    </div>

    <!-- Crystal Ball Modal -->
    <div id="crystal-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCrystalModal()">&times;</span>
            <div class="modal-header">
                <h2>üîÆ‚ú® MYSTICAL STAT ASSESSMENT ‚ú®üîÆ</h2>
            </div>

            <div class="crystal-instructions">
                <p><strong>The ancient crystal reveals your true abilities...</strong></p>
                <p>Rate each skill from 1-100 based on your current level:</p>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li><strong>1-20:</strong> Complete beginner</li>
                    <li><strong>21-40:</strong> Some experience/knowledge</li>
                    <li><strong>41-60:</strong> Intermediate proficiency</li>
                    <li><strong>61-80:</strong> Advanced/Skilled</li>
                    <li><strong>81-100:</strong> Expert/Master level</li>
                </ul>
            </div>

            <div id="crystal-content"></div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="button crystal" onclick="completeCrystalAssessment()">‚ú® Complete Assessment</button>
                <button class="button danger" onclick="closeCrystalModal()">‚ùå Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Game data structure
        const ATTRIBUTES = {
            "life_skills": [
                "communication", "critical_thinking_problem_solving", "time_management",
                "self_care_emotional_regulation", "cooking_nutrition", "car_home_maintenance",
                "digital_literacy", "interpersonal_social_skills", "independence", "learning_efficiency"
            ],
            "content_creation": [
                "seo_literacy", "video_editing", "streaming", "long_form_content_output",
                "short_form_content_output", "charisma", "personality_authenticity",
                "online_presence", "consistency", "backlog_management"
            ],
            "financial_literacy": [
                "budgeting_savings", "emergency_fund_management", "investment_knowledge",
                "retirement_contributions_roth", "401k_optimization", "hsa_utilization",
                "insurance_literacy", "loan_understanding", "tax_optimization", "financial_goal_tracking"
            ],
            "career": [
                "technical_mastery", "soft_skills_work", "time_management_work",
                "growth_milestones", "professional_networking", "contribution_tracking",
                "performance_feedback", "industry_knowledge", "leadership_development", "project_management"
            ],
            "vision_strategy": [
                "daily_goal_setting", "weekly_planning", "monthly_goal_review",
                "quarterly_assessment", "yearly_vision_alignment", "system_design",
                "reflection_reviewing", "strategic_thinking", "priority_management", "personal_roadmapping"
            ]
        };

        // Initialize localStorage data
        function initializeData() {
            if (!localStorage.getItem('soloLevelingSkills')) {
                const skills = {};
                for (const attribute in ATTRIBUTES) {
                    skills[attribute] = {};
                    for (const skill of ATTRIBUTES[attribute]) {
                        skills[attribute][skill] = 1;
                    }
                }
                localStorage.setItem('soloLevelingSkills', JSON.stringify(skills));
            }

            if (!localStorage.getItem('soloLevelingSessions')) {
                localStorage.setItem('soloLevelingSessions', JSON.stringify([]));
            }
        }

        // Utility functions
        function formatSkillName(skillName) {
            return skillName.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function formatAttributeName(attrName) {
            return attrName.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function sigmoidLevelCalculation(totalPoints, maxPoints) {
            if (totalPoints <= 0) return 1;

            const x = totalPoints / maxPoints;
            const sigmoidValue = 1 / (1 + Math.exp(-10 * (x - 0.5)));
            const level = Math.floor(1 + sigmoidValue * 99);
            return Math.min(level, 100);
        }

        // Data management functions
        function getSkills() {
            return JSON.parse(localStorage.getItem('soloLevelingSkills') || '{}');
        }

        function setSkills(skills) {
            localStorage.setItem('soloLevelingSkills', JSON.stringify(skills));
        }

        function getSessions() {
            return JSON.parse(localStorage.getItem('soloLevelingSessions') || '[]');
        }

        function setSessions(sessions) {
            localStorage.setItem('soloLevelingSessions', JSON.stringify(sessions));
        }

        function calculateAttributeLevel(attribute) {
            const skills = getSkills();
            const attrSkills = skills[attribute] || {};
            const totalSkillPoints = Object.values(attrSkills).reduce((sum, level) => sum + level, 0);
            const maxSkillPoints = ATTRIBUTES[attribute].length * 100;
            return sigmoidLevelCalculation(totalSkillPoints, maxSkillPoints);
        }

        function calculateOverallLevel() {
            let totalAttributePoints = 0;
            for (const attribute in ATTRIBUTES) {
                totalAttributePoints += calculateAttributeLevel(attribute);
            }
            return totalAttributePoints;
        }

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');

            // Load tab content
            switch (tabName) {
                case 'stats':
                    refreshStatsDisplay();
                    break;
                case 'update':
                    refreshUpdateDisplay();
                    break;
                case 'progress':
                    showAttributeChart();
                    break;
                case 'history':
                    refreshHistoryDisplay();
                    break;
            }
        }

        // Stats display
        function refreshStatsDisplay() {
            const container = document.getElementById('stats-container');
            const skills = getSkills();

            container.innerHTML = '';

            for (const attribute in ATTRIBUTES) {
                const attrLevel = calculateAttributeLevel(attribute);
                const attrName = formatAttributeName(attribute);

                const section = document.createElement('div');
                section.className = 'attribute-section';

                const header = document.createElement('div');
                header.className = 'attribute-header';
                header.textContent = `üìä ${attrName} - Level ${attrLevel}/100`;
                section.appendChild(header);

                // Progress bar for attribute
                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';
                const progressFill = document.createElement('div');
                progressFill.className = 'progress-fill';
                progressFill.style.width = `${attrLevel}%`;
                progressFill.textContent = `${attrLevel}%`;
                progressBar.appendChild(progressFill);
                section.appendChild(progressBar);

                const skillsGrid = document.createElement('div');
                skillsGrid.className = 'skills-grid';

                const attrSkills = skills[attribute] || {};
                for (const skill of ATTRIBUTES[attribute]) {
                    const skillLevel = attrSkills[skill] || 1;
                    const skillName = formatSkillName(skill);

                    const skillItem = document.createElement('div');
                    skillItem.className = 'skill-item';
                    skillItem.innerHTML = `
                        <span class="skill-name">${skillName}</span>
                        <span class="skill-level">${skillLevel}/100</span>
                    `;
                    skillsGrid.appendChild(skillItem);
                }

                section.appendChild(skillsGrid);
                container.appendChild(section);
            }
        }

        // Update display
        function refreshUpdateDisplay() {
            const container = document.getElementById('update-container');
            const skills = getSkills();

            container.innerHTML = '';

            for (const attribute in ATTRIBUTES) {
                const attrName = formatAttributeName(attribute);

                const section = document.createElement('div');
                section.className = 'update-attribute';

                const header = document.createElement('div');
                header.className = 'attribute-header';
                header.textContent = attrName;
                section.appendChild(header);

                const updateForm = document.createElement('div');
                updateForm.className = 'update-form';

                const attrSkills = skills[attribute] || {};
                for (const skill of ATTRIBUTES[attribute]) {
                    const currentLevel = attrSkills[skill] || 1;
                    const skillName = formatSkillName(skill);

                    const skillDiv = document.createElement('div');
                    skillDiv.className = 'update-skill';
                    skillDiv.innerHTML = `
                        <label>${skillName}:</label>
                        <span class="current-level">[${currentLevel}]</span>
                        <input type="number" 
                               id="update-${attribute}-${skill}"
                               min="${currentLevel}" 
                               max="100" 
                               placeholder="New level">
                    `;
                    updateForm.appendChild(skillDiv);
                }

                section.appendChild(updateForm);
                container.appendChild(section);
            }
        }

        // Process skill updates
        function processSkillUpdates() {
            const skills = getSkills();
            const updates = [];
            let totalGains = 0;

            // Collect all updates
            for (const attribute in ATTRIBUTES) {
                for (const skill of ATTRIBUTES[attribute]) {
                    const input = document.getElementById(`update-${attribute}-${skill}`);
                    if (input && input.value) {
                        const newLevel = parseInt(input.value);
                        const currentLevel = skills[attribute][skill] || 1;

                        // Validation
                        if (newLevel < currentLevel) {
                            alert(`Cannot decrease ${formatSkillName(skill)} level!`);
                            return;
                        }

                        if (newLevel > currentLevel + 10) {
                            alert(`Max +10 increase for ${formatSkillName(skill)}!`);
                            return;
                        }

                        if (newLevel > 100) {
                            alert(`Max level is 100 for ${formatSkillName(skill)}!`);
                            return;
                        }

                        if (newLevel > currentLevel) {
                            const gain = newLevel - currentLevel;
                            updates.push({
                                attribute,
                                skill,
                                oldLevel: currentLevel,
                                newLevel,
                                gain
                            });
                            totalGains += gain;
                        }
                    }
                }
            }

            if (updates.length === 0) {
                alert('No changes to save.');
                return;
            }

            // Get custom date
            const customDate = document.getElementById('custom-date').value;
            const timestamp = customDate ?
                new Date(customDate + 'T' + new Date().toTimeString().split(' ')[0]).toISOString() :
                new Date().toISOString();

            // Apply updates
            for (const update of updates) {
                if (!skills[update.attribute]) {
                    skills[update.attribute] = {};
                }
                skills[update.attribute][update.skill] = update.newLevel;
            }
            setSkills(skills);

            // Save session
            const sessions = getSessions();
            const session = {
                id: Date.now(),
                timestamp,
                totalGains,
                sessionType: 'skill_update',
                notes: '',
                updates
            };
            sessions.push(session);
            setSessions(sessions);

            // Clear inputs
            for (const attribute in ATTRIBUTES) {
                for (const skill of ATTRIBUTES[attribute]) {
                    const input = document.getElementById(`update-${attribute}-${skill}`);
                    if (input) input.value = '';
                }
            }
            document.getElementById('custom-date').value = '';

            alert(`Updated ${updates.length} skills with +${totalGains} total levels!`);
            refreshAllData();
        }

        // Crystal Ball functions
        function showCrystalBallDialog() {
            const modal = document.getElementById('crystal-modal');
            const content = document.getElementById('crystal-content');

            content.innerHTML = '';

            for (const attribute in ATTRIBUTES) {
                const attrName = formatAttributeName(attribute);

                const section = document.createElement('div');
                section.style.marginBottom = '20px';

                const header = document.createElement('h3');
                header.textContent = attrName;
                header.style.color = 'var(--secondary-text)';
                header.style.marginBottom = '10px';
                section.appendChild(header);

                const skillsDiv = document.createElement('div');
                skillsDiv.className = 'crystal-rating';

                for (const skill of ATTRIBUTES[attribute]) {
                    const skillName = formatSkillName(skill);

                    const skillDiv = document.createElement('div');
                    skillDiv.className = 'crystal-skill';
                    skillDiv.innerHTML = `
                        <label>üîç ${skillName}:</label>
                        <input type="number" 
                               id="crystal-${attribute}-${skill}"
                               min="1" 
                               max="100" 
                               value="1">
                    `;
                    skillsDiv.appendChild(skillDiv);
                }

                section.appendChild(skillsDiv);
                content.appendChild(section);
            }

            modal.style.display = 'block';
        }

        function closeCrystalModal() {
            document.getElementById('crystal-modal').style.display = 'none';
        }

        function completeCrystalAssessment() {
            const skills = getSkills();
            let totalGains = 0;
            const updates = [];

            // Collect crystal ball ratings
            for (const attribute in ATTRIBUTES) {
                if (!skills[attribute]) {
                    skills[attribute] = {};
                }

                for (const skill of ATTRIBUTES[attribute]) {
                    const input = document.getElementById(`crystal-${attribute}-${skill}`);
                    if (input) {
                        const newLevel = Math.max(1, Math.min(100, parseInt(input.value) || 1));
                        const oldLevel = skills[attribute][skill] || 1;
                        const gain = newLevel - oldLevel;

                        skills[attribute][skill] = newLevel;
                        totalGains += gain;

                        updates.push({
                            attribute,
                            skill,
                            oldLevel,
                            newLevel,
                            gain
                        });
                    }
                }
            }

            setSkills(skills);

            // Save crystal ball session
            const sessions = getSessions();
            const session = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                totalGains,
                sessionType: 'crystal_ball_assessment',
                notes: 'Initial stat assessment using the mystical crystal ball',
                updates
            };
            sessions.push(session);
            setSessions(sessions);

            closeCrystalModal();
            alert('‚ú® The crystal has revealed your true power!\nYour stats have been updated.');
            refreshAllData();
        }

        // Chart functions (simplified - using Canvas for basic visualization)
        function showAttributeChart() {
            const canvas = document.getElementById('progress-chart');
            const ctx = canvas.getContext('2d');

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Get attribute levels
            const attributes = Object.keys(ATTRIBUTES);
            const levels = attributes.map(attr => calculateAttributeLevel(attr));

            // Chart settings
            const barWidth = 80;
            const barSpacing = 20;
            const chartHeight = 300;
            const chartTop = 50;
            const maxLevel = 100;

            // Draw bars
            attributes.forEach((attr, index) => {
                const level = levels[index];
                const barHeight = (level / maxLevel) * chartHeight;
                const x = 50 + index * (barWidth + barSpacing);
                const y = chartTop + chartHeight - barHeight;

                // Draw bar
                ctx.fillStyle = ['var(--secondary-text)', '#f7768e', '#9ece6a', '#e0af68', 'var(--accent-color)'][index % 5];
                ctx.fillRect(x, y, barWidth, barHeight);

                // Draw label
                ctx.fillStyle = 'var(--primary-text)';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(formatAttributeName(attr), x + barWidth / 2, chartTop + chartHeight + 20);

                // Draw value
                ctx.fillStyle = 'var(--primary-text)';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(level.toString(), x + barWidth / 2, y - 5);
            });

            // Draw title
            ctx.fillStyle = 'var(--secondary-text)';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üìä Attribute Levels', canvas.width / 2, 30);
        }

        function showProgressChart() {
            const canvas = document.getElementById('progress-chart');
            const ctx = canvas.getContext('2d');

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Get sessions for progress over time
            const sessions = getSessions().slice(-10); // Last 10 sessions

            if (sessions.length === 0) {
                ctx.fillStyle = 'var(--primary-text)';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No session data available', canvas.width / 2, canvas.height / 2);
                return;
            }

            // Chart settings
            const chartWidth = canvas.width - 100;
            const chartHeight = 300;
            const chartTop = 50;
            const chartLeft = 50;

            // Calculate points
            const points = sessions.map((session, index) => {
                const x = chartLeft + (index / (sessions.length - 1)) * chartWidth;
                const y = chartTop + chartHeight - (session.totalGains / 50) * chartHeight; // Scale by max 50 gains
                return { x, y, gains: session.totalGains, date: new Date(session.timestamp).toLocaleDateString() };
            });

            // Draw grid lines
            ctx.strokeStyle = 'var(--border-color)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = chartTop + (i / 5) * chartHeight;
                ctx.beginPath();
                ctx.moveTo(chartLeft, y);
                ctx.lineTo(chartLeft + chartWidth, y);
                ctx.stroke();
            }

            // Draw line
            ctx.strokeStyle = 'var(--secondary-text)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            points.forEach((point, index) => {
                if (index === 0) {
                    ctx.moveTo(point.x, point.y);
                } else {
                    ctx.lineTo(point.x, point.y);
                }
            });
            ctx.stroke();

            // Draw points
            ctx.fillStyle = '#f7768e';
            points.forEach(point => {
                ctx.beginPath();
                ctx.arc(point.x, point.y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });

            // Draw title
            ctx.fillStyle = 'var(--secondary-text)';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üìà Progress Over Time', canvas.width / 2, 30);
        }

        function showSkillHeatmap() {
            const canvas = document.getElementById('progress-chart');
            const ctx = canvas.getContext('2d');

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const skills = getSkills();
            const allSkills = [];

            // Collect all skills
            for (const attribute in ATTRIBUTES) {
                for (const skill of ATTRIBUTES[attribute]) {
                    const level = skills[attribute] ? skills[attribute][skill] || 1 : 1;
                    allSkills.push({
                        name: formatSkillName(skill),
                        level,
                        attribute
                    });
                }
            }

            // Sort by level
            allSkills.sort((a, b) => b.level - a.level);

            // Display top skills
            const topSkills = allSkills.slice(0, 15);
            const barHeight = 20;
            const barSpacing = 5;
            const maxWidth = canvas.width - 200;

            topSkills.forEach((skill, index) => {
                const y = 50 + index * (barHeight + barSpacing);
                const barWidth = (skill.level / 100) * maxWidth;

                // Color based on level
                let color = 'var(--border-color)';
                if (skill.level >= 80) color = '#9ece6a';
                else if (skill.level >= 60) color = '#e0af68';
                else if (skill.level >= 40) color = 'var(--secondary-text)';
                else if (skill.level >= 20) color = 'var(--accent-color)';

                // Draw bar
                ctx.fillStyle = color;
                ctx.fillRect(150, y, barWidth, barHeight);

                // Draw skill name
                ctx.fillStyle = 'var(--primary-text)';
                ctx.font = '12px Arial';
                ctx.textAlign = 'right';
                ctx.fillText(skill.name, 145, y + 15);

                // Draw level
                ctx.fillStyle = 'var(--primary-text)';
                ctx.textAlign = 'left';
                ctx.fillText(skill.level.toString(), 155 + barWidth, y + 15);
            });

            // Draw title
            ctx.fillStyle = 'var(--secondary-text)';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üéØ Top Skills Overview', canvas.width / 2, 30);
        }

        // History display
        function refreshHistoryDisplay() {
            const tbody = document.getElementById('history-tbody');
            const sessions = getSessions().slice(-20).reverse(); // Last 20 sessions, newest first

            tbody.innerHTML = '';

            if (sessions.length === 0) {
                const row = tbody.insertRow();
                row.innerHTML = '<td colspan="4" style="text-align: center; color: var(--secondary-accent);">No session history available</td>';
                return;
            }

            sessions.forEach(session => {
                const row = tbody.insertRow();
                const date = new Date(session.timestamp).toLocaleDateString();
                const time = new Date(session.timestamp).toLocaleTimeString();

                row.innerHTML = `
                    <td>${date} ${time}</td>
                    <td>${session.sessionType === 'crystal_ball_assessment' ? 'üîÆ Crystal Ball' : 'üìà Skill Update'}</td>
                    <td style="color: #9ece6a;">+${session.totalGains} levels</td>
                    <td>${session.notes || 'Regular skill update'}</td>
                `;
            });
        }

        // Overall level update
        function updateOverallLevel() {
            const overallLevel = calculateOverallLevel();
            document.getElementById('overall-level').textContent = `üèÜ OVERALL LEVEL: ${overallLevel}/500`;
        }

        // Refresh all data
        function refreshAllData() {
            updateOverallLevel();
            refreshStatsDisplay();
            refreshUpdateDisplay();
            refreshHistoryDisplay();
        }

        // Modal click outside to close
        window.onclick = function (event) {
            const modal = document.getElementById('crystal-modal');
            if (event.target === modal) {
                closeCrystalModal();
            }
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function () {
            initializeData();
            refreshAllData();
            showAttributeChart(); // Default chart

            // Set today's date as default for custom date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('custom-date').value = today;
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function (event) {
            if (event.ctrlKey || event.metaKey) {
                switch (event.key) {
                    case '1':
                        event.preventDefault();
                        showTab('stats');
                        break;
                    case '2':
                        event.preventDefault();
                        showTab('update');
                        break;
                    case '3':
                        event.preventDefault();
                        showTab('progress');
                        break;
                    case '4':
                        event.preventDefault();
                        showTab('history');
                        break;
                    case 's':
                        event.preventDefault();
                        processSkillUpdates();
                        break;
                    case 'r':
                        event.preventDefault();
                        refreshAllData();
                        break;
                }
            }
        });

        // Export/Import functionality (bonus feature)
        function exportData() {
            const data = {
                skills: getSkills(),
                sessions: getSessions(),
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `solo_leveling_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.skills && data.sessions) {
                        if (confirm('This will replace all current data. Are you sure?')) {
                            setSkills(data.skills);
                            setSessions(data.sessions);
                            refreshAllData();
                            alert('Data imported successfully!');
                        }
                    } else {
                        alert('Invalid backup file format.');
                    }
                } catch (error) {
                    alert('Error reading backup file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
    </script>
</body>

</html>
